# Архитектура проекта DraftPractice

Документ фиксирует договорённую целевую архитектуру симулятора драфта Dota 2 в режиме Captains Mode. Он служит ориентиром при развитии репозитория и помогает сверяться с исходным планом.

## Общая схема

Система состоит из нескольких взаимосвязанных подсистем:

1. **Источники данных и аналитика**  
   - сервис-инжестор получает метовые показатели (винрейты, пики/баны) из открытых API (OpenDota, Stratz и т. п.);  
   - результаты складываются в PostgreSQL, а «горячие» агрегаты кешируются в Redis;  
   - периодические задания (cron/Go job) пересчитывают дополнительные метрики: синергии, контрпики, эффективность линий.
2. **Серверная часть (Go)**  
   - доменная логика драфта (стадии, валидация ходов, таймеры);  
   - модуль бота/ИИ, принимающий решения на основе статистики и эвристик;  
   - оценка линий и итоговая вероятность победы;  
   - HTTP API (REST/GraphQL) и WebSocket/SSE для realtime-обновления;  
   - авторизация/профили пользователей (по мере необходимости).
3. **Фронтенд (React + TypeScript)**  
   - интерфейс драфта с визуализацией стадий пиков/банов;  
   - панели аналитики (сравнение линий, потенциал пиков, вероятность победы);  
   - drag-and-drop героев, подсветка синергий/контрпиков;  
   - работа с актуальными ассетами (иконки, названия героев).
4. **ML и фоновые сервисы**  
   - выделенные воркеры для обучения/обновления моделей;  
   - очереди сообщений (NATS/RabbitMQ/Kafka) при высоком трафике;  
   - пайплайны для переобучения и A/B-тестов стратегий.
5. **Инфраструктура и эксплуатация**  
   - контейнеризация (Docker/Kubernetes);  
   - CI/CD (GitHub Actions) для сборки, тестов и деплоя;  
   - мониторинг (Prometheus + Grafana), логирование и алёрты (Sentry/ELK).

## Серверная часть подробнее

- `internal/draft` — доменные модели, управление сессиями, бизнес-правила Captains Mode.
- `internal/heroes` — каталог героев и статистики, интеграции с внешними API, фоновое обновление кэша.
- `internal/server` — HTTP-слой, маршрутизация, WebSocket/SSE подключения.
- `cmd/draft-api` — entrypoint сервиса и wire-up зависимостей.
- ML-модуль может быть встроен в Go (через gonum/xgboost) либо вынесен в отдельный микросервис (например, Python + FastAPI).

## Фронтенд

- Базируется на React + TypeScript.
- Хранение состояния — Zustand/Redux; загрузка данных — react-query или Apollo Client (при GraphQL).
- UI-библиотека — Material UI или Tailwind; поддержка темной темы.
- Ключевые страницы: лобби/выбор режима, экран драфта, отчёт после драфта.

## Данные и аналитика

- PostgreSQL хранит исторические метрики, результаты матчей, пользовательские настройки.
- Redis обеспечивает быстрый доступ к статистике, необходимой во время драфта.
- Отдельный модуль обновляет данные о героях (`heroStats`) каждые 24 часа, с fallback на последнюю успешную загрузку.
- Фичи для моделей: частоты пиков/банов, винрейты по ролям/линиям, синергии, счётчики героев, тайминги стадий драфта.

## Бот и оценка пиков

- Начальный уровень: набор эвристик (приоритеты по ролям, контрпики).  
- Расширение: ML-модель (градиентный бустинг, рекомендательная система или reinforcement learning) обучается на данных профессиональных драфтов.  
- Оценка итоговой вероятности победы строится на модели классификации (логистическая регрессия, XGBoost, нейросеть) с explainability (например, SHAP-подсказки).

## План развития (MVP → продакшн)

1. **MVP**: базовый Go API + React UI, герои из OpenDota, in-memory хранение и простейший бот.  
2. **Интеграция статистики**: пайплайн загрузки турнирных данных, хранение в БД, расширение API.  
3. **ML и аналитика**: обучение моделей пиков и оценки победы, визуализация на фронтенде.  
4. **Инфраструктура**: CI/CD, контейнеризация, мониторинг, авторизация пользователей.  
5. **Итеративные улучшения**: оптимизация бота, добавление историй драфтов, режимов тренировок.

## Структура репозитория (целевой вид)

```
/README.md
/ARCHITECTURE.md
/backend
  /cmd/draft-api
  /internal/draft
  /internal/heroes
  /internal/server
/frontend
  /src
  /public
/infra
  docker-compose.yml
  k8s/
/ml
  /notebooks
  /models
```

Документ будет обновляться по мере развития проекта. Предложения по изменениям архитектуры фиксируются через pull request с соответствующим обсуждением.
