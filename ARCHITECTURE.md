# Архитектура проекта DraftPractice (обновлённая версия)

Документ фиксирует актуальную архитектуру симулятора драфта **Dota 2 Captains Mode**. Он отражает текущее состояние реализации и намечает дальнейшие шаги по развитию системы.

---

## Общая схема

Система состоит из пяти взаимосвязанных подсистем:

1. **Источники данных и аналитика**

   * Инжестор получает метовые показатели (винрейты, пики/баны, синергии) из открытых API: OpenDota, Stratz.
   * Результаты хранятся в PostgreSQL, «горячие» агрегаты кешируются в Redis.
   * Планируется периодический перерасчёт метрик и ML-фичей (через Go job или cron).

2. **Серверная часть (Go)**

   * Доменные модели и правила драфта (все стадии Captains Mode).
   * Таймеры, резервы времени и автоматические действия при истечении таймера.
   * Модуль бота с разными скоростями реакции (fast / medium / slow).
   * REST-API и WebSocket-потоки для живого обновления стадии драфта.
   * Возможность указать, какая сторона управляется ботом и кто делает первый пик.

3. **Фронтенд (React + TypeScript)**

   * Интерфейс драфта с отображением стадий, таймеров и текущего состояния.
   * Панель героев с фильтрами, поиск, подсветка занятых персонажей.
   * В будущем — визуализация аналитики: синергии, контрпики, вероятность победы.

4. **ML и аналитика**

   * Отдельный сервис или воркер, обучающий модели на данных OpenDota.
   * Поддержка моделей рекомендательной логики и оценки винрейта (XGBoost / RL / нейросети).
   * В дальнейшем — подсказки по пик/бану в реальном времени.

5. **Инфраструктура**

   * Контейнеризация через Docker.
   * docker-compose с PostgreSQL + Redis.
   * GitHub Actions для CI/CD и автоматического деплоя.
   * Мониторинг и логирование (Prometheus / Grafana / Sentry).

---

## Текущая реализация серверной части

* **`internal/draft`** — ядро логики драфта:

  * хранение активных сессий (`Store`);
  * структура `DraftSession` (таймеры, стороны, стадии);
  * автоматические пики и баны при истечении времени;
  * реакция бота с задержкой в зависимости от скорости;
  * клон сессии для потоковых обновлений.
* **`internal/heroes`** — загрузка и кэширование данных о героях из OpenDota.
* **`internal/server`** — REST и WebSocket API:

  * `/api/sessions` — создание новой сессии;
  * `/api/sessions/{id}` — получение состояния;
  * `/api/sessions/{id}/action` — пик/бан;
  * `/api/sessions/{id}/stream` — WebSocket-подключение для обновлений каждую секунду;
  * `/api/heroes` — список героев;
  * `/health` — проверка состояния сервера.
* **`cmd/draft-api`** — точка входа, инициализация зависимостей, запуск сервера.

---

## Поведение бота

* Каждая сессия хранит поля:

  * `BotSide` — какая сторона управляется ботом;
  * `BotSpeed` — задержка реакции:

    * fast = 1–3 сек,
    * medium = 3–7 сек,
    * slow = 7–12 сек.
* Если первый пик у бота — он автоматически делает ход после небольшой «задумчивости».
* После каждого действия игрока бот проверяет, его ли теперь очередь, и при необходимости действует.

---

## Таймеры и резервы

* Основное время хода (например, 30 сек) и резерв (по ~130 сек).
* При истечении основного таймера расходуется резерв; при нуле — автоход.
* Все таймеры обновляются каждую секунду и транслируются клиенту по WebSocket.

---

## Фронтенд (MVP-версия)

**Цель — собрать прототип на React**, подключённый к API:

* форма создания сессии (ввод имён, стороны, скорость бота);
* экран драфта:

  * список героев (поиск);
  * текущая стадия и таймер;
  * отображение выбранных/забаненных героев;
  * лог событий;
* подключение по WebSocket для realtime-обновлений.

---

## План расширения

| Этап                  | Задачи                                                 |
| --------------------- | ------------------------------------------------------ |
| **1. MVP**            | REST + WebSocket, базовый бот, таймеры, фронт-прототип |
| **2. Аналитика**      | интеграция с OpenDota, метрики героев, контрпики       |
| **3. ML-бот**         | обучение модели и внедрение логики принятия решений    |
| **4. База данных**    | PostgreSQL, Redis, история драфтов                     |
| **5. Инфраструктура** | Docker, CI/CD, мониторинг, аутентификация              |
| **6. UX-расширения**  | матч-реплеи, тренировки, сравнение стратегий           |

---

## Текущее состояние

| Компонент    | Прогресс | Примечание                                 |
| ------------ | -------- | ------------------------------------------ |
| **Backend**  | 70 %     | API и логика драфта готовы, есть WebSocket |
| **Bot AI**   | 30 %     | сейчас — рандом, план — эвристики и ML     |
| **Frontend** | 10 %     | интерфейс в разработке                     |
| **Data/ML**  | 0 %      | интеграции запланированы                   |
| **Infra/CI** | 0 %      | Docker + GitHub Actions — в планах         |

---

## Структура репозитория (на 2025-й)

```
/README.md
/ARCHITECTURE.md
/backend
  /cmd/draft-api
  /internal/draft
  /internal/heroes
  /internal/server
/frontend
  /src
  /public
/infra
  docker-compose.yml
  k8s/
```

---
